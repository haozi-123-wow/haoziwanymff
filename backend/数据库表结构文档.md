# 数据库表结构文档

## 文档说明

本文档描述 `haoziwanymff` 数据库的完整表结构设计。

**数据库信息**:
- 数据库名: `haoziwanymff`
- 字符集: `utf8mb4`
- 排序规则: `utf8mb4_unicode_ci`
- MySQL版本: 5.7.44

---

## 表结构概览

| 序号 | 表名 | 说明 |
|------|------|------|
| 1 | `admin_audit_logs` | 管理员审计日志表 |
| 2 | `admin_session_logs` | 管理员会话日志表 |
| 3 | `audit_failures` | 审核失败记录表 |
| 4 | `captchas` | 验证令牌表 |
| 5 | `domains` | 域名表 |
| 6 | `email_logs` | 邮件日志表 |
| 7 | `ip_block_audit_logs` | IP封禁审计日志表 |
| 8 | `payment_settings` | 支付配置表 |
| 9 | `platform_domains` | 平台域名表 |
| 10 | `platform_settings` | 云平台配置表 |
| 11 | `security_event_logs` | 安全事件日志表 |
| 12 | `settings` | 系统设置表 |
| 13 | `user_verifications` | 用户实名认证表 |
| 14 | `users` | 用户表 |

---

## 1. admin_audit_logs 表

**表说明**: 管理员审计日志表，记录管理员的所有操作

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | int | 11 | NO | AUTO_INCREMENT | 主键ID |
| admin_session_id | varchar | 100 | NO | - | 管理员会话ID |
| action_type | varchar | 50 | NO | - | 操作类型 |
| action_description | text | - | YES | NULL | 操作描述 |
| action_reason | text | - | YES | NULL | 操作原因 |
| target_id | int | 11 | YES | NULL | 目标ID |
| target_type | varchar | 50 | YES | NULL | 目标类型 |
| target_content | text | - | YES | NULL | 目标内容 |
| ip_address | varchar | 45 | YES | NULL | IP地址 |
| user_agent | text | - | YES | NULL | 用户代理 |
| request_method | varchar | 10 | YES | NULL | 请求方法 |
| request_url | text | - | YES | NULL | 请求URL |
| request_body | json | - | YES | NULL | 请求体 |
| response_code | int | 11 | YES | NULL | 响应状态码 |
| response_message | text | - | YES | NULL | 响应消息 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_admin_session_id | admin_session_id | KEY |
| idx_action_type | action_type | KEY |
| idx_created_at | created_at | KEY |
| idx_target_id | target_id | KEY |
| idx_ip_address | ip_address | KEY |

---

## 2. admin_session_logs 表

**表说明**: 管理员会话日志表，记录管理员登录登出

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | int | 11 | NO | AUTO_INCREMENT | 主键ID |
| admin_session_id | varchar | 100 | NO | - | 管理员会话ID |
| action_type | enum | - | NO | - | 操作类型 (LOGIN/LOGOUT) |
| ip_address | varchar | 45 | YES | NULL | IP地址 |
| user_agent | text | - | YES | NULL | 用户代理 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_admin_session_id | admin_session_id | KEY |
| idx_action_type | action_type | KEY |
| idx_created_at | created_at | KEY |

---

## 3. audit_failures 表

**表说明**: 审核失败记录表，记录IP审核失败次数

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint | 20 | NO | AUTO_INCREMENT | 主键ID |
| user_ip | varchar | 45 | NO | - | 用户IP地址 |
| failure_count | int | 11 | YES | 1 | 失败次数 |
| first_failure_at | timestamp | - | YES | CURRENT_TIMESTAMP | 首次失败时间 |
| last_failure_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 最后失败时间 |
| is_blocked | tinyint | 1 | YES | 0 | 是否被封禁 |
| blocked_at | timestamp | - | YES | NULL | 封禁时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_user_ip | user_ip | KEY |
| idx_is_blocked | is_blocked | KEY |
| idx_last_failure_at | last_failure_at | KEY |

---

## 4. captchas 表

**表说明**: 验证令牌表，存储验证码令牌

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 令牌ID |
| token | varchar | 255 | NO | - | 验证令牌 |
| user_id | bigint unsigned | 20 | YES | NULL | 关联用户ID |
| expires_at | datetime | - | NO | - | 过期时间 |
| used | tinyint | 1 | YES | 0 | 是否已使用 |
| type | varchar | 50 | YES | 'geetest' | 令牌类型 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| token | token | UNIQUE |
| idx_token | token | KEY |
| idx_user_id | user_id | KEY |
| idx_expires_at | expires_at | KEY |
| idx_used | used | KEY |

---

## 5. domains 表

**表说明**: 域名表，存储可使用的域名信息

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint | 20 | NO | AUTO_INCREMENT | 主键ID |
| domain | varchar | 255 | NO | - | 域名 (如: example.com) |
| price | decimal | 10,2 | YES | 0.00 | 域名使用价格 |
| require_icp | tinyint | 1 | YES | 0 | 是否需要备案 |
| platform_id | bigint | 20 | NO | - | 关联的平台配置ID |
| is_active | tinyint | 1 | YES | 1 | 是否启用 |
| is_public | tinyint | 1 | YES | 1 | 是否公开(允许用户注册) |
| remarks | varchar | 255 | YES | NULL | 备注 |
| created_at | datetime | - | NO | - | 创建时间 |
| updated_at | datetime | - | NO | - | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| domain | domain | UNIQUE |
| domains_domain | domain | UNIQUE |
| platform_id | platform_id | KEY |
| domains_platform_id | platform_id | KEY |
| domains_is_active | is_active | KEY |
| domains_is_public | is_public | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 | 更新规则 |
|--------|------|--------|----------|----------|----------|
| domains_ibfk_1 | platform_id | platform_settings | id | CASCADE | CASCADE |

---

## 6. email_logs 表

**表说明**: 邮件日志表，记录邮件发送情况

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 日志ID |
| user_id | bigint unsigned | 20 | YES | NULL | 关联用户ID |
| recipient | varchar | 255 | NO | - | 收件人邮箱 |
| subject | varchar | 255 | NO | - | 邮件主题 |
| content | text | - | YES | NULL | 邮件内容 |
| status | enum | - | YES | 'pending' | 发送状态 |
| error_message | text | - | YES | NULL | 错误信息 |
| sent_at | timestamp | - | YES | NULL | 发送时间 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_user_id | user_id | KEY |
| idx_recipient | recipient | KEY |
| idx_status | status | KEY |
| idx_sent_at | sent_at | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| email_logs_ibfk_1 | user_id | users | id | SET NULL |

---

## 7. ip_block_audit_logs 表

**表说明**: IP封禁审计日志表

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | int | 11 | NO | AUTO_INCREMENT | 主键ID |
| admin_session_id | varchar | 100 | YES | NULL | 管理员会话ID |
| ip_address | varchar | 45 | NO | - | IP地址 |
| block_reason | text | - | YES | NULL | 封禁原因 |
| target_speech_id | int | 11 | YES | NULL | 目标话语ID |
| target_content | text | - | YES | NULL | 目标内容 |
| edgeone_result | json | - | YES | NULL | EdgeOne封禁结果 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_ip_address | ip_address | KEY |
| idx_admin_session_id | admin_session_id | KEY |
| idx_created_at | created_at | KEY |

---

## 8. payment_settings 表

**表说明**: 支付配置表，存储支付方式配置

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint | 20 | NO | AUTO_INCREMENT | 主键ID |
| payment_method | varchar | 50 | NO | - | 支付方式 |
| payment_name | varchar | 100 | NO | - | 支付方式名称 |
| config_data | json | - | NO | - | 配置数据 |
| is_enabled | tinyint | 1 | YES | 0 | 是否启用 |
| sort_order | int | 11 | YES | 0 | 排序顺序 |
| description | text | - | YES | NULL | 配置描述 |
| created_at | datetime | - | NO | - | 创建时间 |
| updated_at | datetime | - | NO | - | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| payment_method | payment_method | UNIQUE |

---

## 9. platform_domains 表

**表说明**: 平台域名表

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint | 20 | NO | AUTO_INCREMENT | 域名ID |
| platform_id | bigint | 20 | NO | - | 关联的云平台配置ID |
| domain_name | varchar | 255 | NO | - | 域名 |
| price | decimal | 10,2 | NO | - | 域名使用价格(元) |
| need_filing | tinyint | 1 | YES | 1 | 是否需要备案 |
| is_public | tinyint | 1 | YES | 1 | 是否公开 |
| remarks | text | - | YES | NULL | 备注 |
| is_active | tinyint | 1 | YES | 1 | 是否启用 |
| created_at | datetime | - | NO | - | 创建时间 |
| updated_at | datetime | - | NO | - | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| domain_name | domain_name | UNIQUE |
| idx_platform_id | platform_id | KEY |
| idx_domain_name | domain_name | KEY |
| idx_is_public | is_public | KEY |
| idx_is_active | is_active | KEY |

---

## 10. platform_settings 表

**表说明**: 云平台配置表，存储DNS平台接入配置

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint | 20 | NO | AUTO_INCREMENT | 主键ID |
| name | varchar | 100 | NO | - | 配置名称 |
| platform | varchar | 255 | NO | - | 平台名称 |
| access_key_id | varchar | 255 | NO | - | Access Key ID |
| access_key_secret | varchar | 255 | NO | - | Access Key Secret |
| is_active | tinyint | 1 | YES | 1 | 是否启用 |
| config | json | - | YES | NULL | 额外配置 |
| created_at | datetime | - | NO | - | 创建时间 |
| updated_at | datetime | - | NO | - | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |

---

## 11. security_event_logs 表

**表说明**: 安全事件日志表

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | int | 11 | NO | AUTO_INCREMENT | 主键ID |
| event_type | varchar | 50 | NO | - | 事件类型 |
| event_level | enum | - | YES | 'INFO' | 事件级别 |
| event_description | text | - | YES | NULL | 事件描述 |
| ip_address | varchar | 45 | YES | NULL | IP地址 |
| user_agent | text | - | YES | NULL | 用户代理 |
| request_data | json | - | YES | NULL | 请求数据 |
| response_data | json | - | YES | NULL | 响应数据 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_event_type | event_type | KEY |
| idx_event_level | event_level | KEY |
| idx_ip_address | ip_address | KEY |
| idx_created_at | created_at | KEY |

---

## 12. settings 表

**表说明**: 系统设置表

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 设置ID |
| key | varchar | 100 | NO | - | 设置键名 |
| value | text | - | NO | - | 设置值(JSON格式) |
| description | varchar | 255 | YES | NULL | 设置描述 |
| type | enum | - | YES | 'general' | 设置类型 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| key | key | UNIQUE |
| idx_key | key | KEY |
| idx_type | type | KEY |

---

## 13. user_verifications 表

**表说明**: 用户实名认证表，存储用户实名认证信息

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 主键ID |
| user_id | bigint unsigned | 20 | NO | - | 用户ID |
| real_name | varchar | 50 | NO | - | 真实姓名 |
| id_card | varchar | 18 | NO | - | 身份证号 |
| id_card_front | varchar | 255 | YES | NULL | 身份证正面照片URL |
| id_card_back | varchar | 255 | YES | NULL | 身份证反面照片URL |
| phone | varchar | 20 | YES | NULL | 手机号 |
| status | enum | - | YES | 'pending' | 认证状态 |
| verified_at | datetime | - | YES | NULL | 认证通过时间 |
| reject_reason | varchar | 255 | YES | NULL | 拒绝原因 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_user_id | user_id | KEY |
| idx_status | status | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_user_verifications_user_id | user_id | users | id | CASCADE |

---

## 14. users 表

**表说明**: 用户表

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 用户ID |
| username | varchar | 50 | NO | - | 用户名 |
| email | varchar | 100 | NO | - | 邮箱 |
| password | varchar | 255 | NO | - | 加密密码 |
| is_active | tinyint | 1 | YES | 0 | 是否激活 |
| is_banned | tinyint | 1 | YES | 0 | 是否封禁 |
| ban_reason | text | - | YES | NULL | 封禁原因 |
| activation_token | varchar | 255 | YES | NULL | 激活令牌 |
| activation_token_expires | datetime | - | YES | NULL | 激活令牌过期时间 |
| role | enum | - | YES | 'user' | 用户角色 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| username | username | UNIQUE |
| email | email | UNIQUE |
| idx_email | email | KEY |
| idx_username | username | KEY |
| idx_activation_token | activation_token | KEY |
| idx_is_banned | is_banned | KEY |

---

## 附录

### 枚举值说明

#### user_verifications.status
- `pending` - 待审核
- `approved` - 已通过
- `rejected` - 已拒绝

#### email_logs.status
- `sent` - 已发送
- `failed` - 发送失败
- `pending` - 待发送

#### admin_session_logs.action_type
- `LOGIN` - 登录
- `LOGOUT` - 登出

#### security_event_logs.event_level
- `INFO` - 信息
- `WARNING` - 警告
- `ERROR` - 错误
- `CRITICAL` - 严重

#### settings.type
- `general` - 通用
- `email` - 邮件
- `geetest` - 极验
- `other` - 其他

#### users.role
- `user` - 普通用户
- `admin` - 管理员

---

## 变更记录

### V2.0 (2024-01-31)
**新增表**:
- `user_verifications` - 用户实名认证表

**删除表**:
- `subdomains` - 用户二级域名表
- `user_domains` - 用户购买域名表
- `user_subdomains` - 用户二级域名表(旧版)

---

## 15. domain_packages 表

**表说明**: 域名套餐表，管理员配置的域名解析套餐

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 套餐ID |
| domain_id | bigint unsigned | 20 | NO | - | 关联域名ID |
| name | varchar | 100 | NO | - | 套餐名称 |
| description | text | - | YES | NULL | 套餐描述 |
| parse_count | int | 11 | NO | - | 解析次数（可添加多少条解析记录） |
| duration_days | int | 11 | NO | - | 有效时长（天） |
| price | decimal | 10,2 | NO | - | 套餐价格 |
| original_price | decimal | 10,2 | YES | NULL | 原价（用于折扣展示） |
| is_active | tinyint | 1 | YES | 1 | 是否启用 |
| sort_order | int | 11 | YES | 0 | 排序顺序 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_domain_id | domain_id | KEY |
| idx_is_active | is_active | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_domain_packages_domain_id | domain_id | domains | id | CASCADE |

---

## 16. user_packages 表

**表说明**: 用户套餐表，记录用户购买的套餐及使用情况

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 用户套餐ID |
| user_id | bigint unsigned | 20 | NO | - | 用户ID |
| package_id | bigint unsigned | 20 | NO | - | 套餐ID |
| domain_id | bigint unsigned | 20 | NO | - | 域名ID |
| order_id | bigint unsigned | 20 | NO | - | 关联订单ID |
| total_count | int | 11 | NO | - | 总解析次数 |
| used_count | int | 11 | YES | 0 | 已使用次数 |
| valid_start | datetime | - | NO | - | 有效期开始 |
| valid_end | datetime | - | NO | - | 有效期结束 |
| status | enum | - | YES | 'active' | 状态(active/expired) |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_user_id | user_id | KEY |
| idx_package_id | package_id | KEY |
| idx_domain_id | domain_id | KEY |
| idx_order_id | order_id | KEY |
| idx_status | status | KEY |
| idx_valid_end | valid_end | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_user_packages_user_id | user_id | users | id | CASCADE |
| fk_user_packages_package_id | package_id | domain_packages | id | CASCADE |
| fk_user_packages_domain_id | domain_id | domains | id | CASCADE |

---

## 17. domain_records 表

**表说明**: 解析记录表，存储用户的DNS解析记录

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 记录ID |
| user_id | bigint unsigned | 20 | NO | - | 用户ID |
| domain_id | bigint unsigned | 20 | NO | - | 域名ID |
| order_id | bigint unsigned | 20 | YES | NULL | 关联订单ID（单次购买时） |
| website_name | varchar | 100 | NO | - | 网站名称 |
| hostname | varchar | 100 | NO | - | 主机名 |
| full_hostname | varchar | 255 | NO | - | 完整主机名（如：www.example.com） |
| record_type | enum | - | NO | - | 解析类型(A/CNAME/AAAA) |
| record_value | varchar | 500 | NO | - | 解析记录值 |
| ttl | int | 11 | YES | 600 | TTL值 |
| remark | varchar | 255 | YES | NULL | 备注 |
| status | enum | - | YES | 'pending' | 状态 |
| cloud_record_id | varchar | 100 | YES | NULL | 云平台解析记录ID |
| reviewed_by | bigint unsigned | 20 | YES | NULL | 审核人ID |
| reviewed_at | datetime | - | YES | NULL | 审核时间 |
| review_remark | varchar | 255 | YES | NULL | 审核备注 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| idx_user_id | user_id | KEY |
| idx_domain_id | domain_id | KEY |
| idx_order_id | order_id | KEY |
| idx_hostname | hostname | KEY |
| idx_full_hostname | full_hostname | KEY |
| idx_status | status | KEY |
| idx_record_type | record_type | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_domain_records_user_id | user_id | users | id | CASCADE |
| fk_domain_records_domain_id | domain_id | domains | id | CASCADE |

---

## 18. parse_orders 表

**表说明**: 解析订单表，记录用户购买解析记录的订单

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 订单ID |
| order_no | varchar | 50 | NO | - | 订单号 |
| user_id | bigint unsigned | 20 | NO | - | 用户ID |
| domain_id | bigint unsigned | 20 | NO | - | 域名ID |
| website_name | varchar | 100 | NO | - | 网站名称 |
| hostname | varchar | 100 | NO | - | 主机名 |
| full_hostname | varchar | 255 | NO | - | 完整主机名 |
| record_type | enum | - | NO | - | 解析类型(A/CNAME/AAAA) |
| record_value | varchar | 500 | NO | - | 解析记录值 |
| ttl | int | 11 | YES | 600 | TTL值 |
| price | decimal | 10,2 | NO | - | 订单价格 |
| deduct_package | tinyint | 1 | YES | 0 | 是否使用套餐抵扣 |
| deducted_package_id | bigint unsigned | 20 | YES | NULL | 抵扣的套餐ID |
| status | enum | - | YES | 'pending' | 订单状态 |
| payment_method | varchar | 50 | YES | NULL | 支付方式 |
| payment_time | datetime | - | YES | NULL | 支付时间 |
| transaction_id | varchar | 100 | YES | NULL | 第三方交易号 |
| remark | varchar | 255 | YES | NULL | 备注 |
| expires_at | datetime | - | YES | NULL | 订单过期时间 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| order_no | order_no | UNIQUE |
| idx_user_id | user_id | KEY |
| idx_domain_id | domain_id | KEY |
| idx_status | status | KEY |
| idx_order_no | order_no | KEY |
| idx_created_at | created_at | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_parse_orders_user_id | user_id | users | id | CASCADE |
| fk_parse_orders_domain_id | domain_id | domains | id | CASCADE |

---

## 19. package_orders 表

**表说明**: 套餐订单表，记录用户购买套餐的订单

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | bigint unsigned | 20 | NO | AUTO_INCREMENT | 订单ID |
| order_no | varchar | 50 | NO | - | 订单号 |
| user_id | bigint unsigned | 20 | NO | - | 用户ID |
| domain_id | bigint unsigned | 20 | NO | - | 域名ID |
| package_id | bigint unsigned | 20 | NO | - | 套餐ID |
| package_name | varchar | 100 | NO | - | 套餐名称（快照） |
| parse_count | int | 11 | NO | - | 解析次数 |
| duration_days | int | 11 | NO | - | 有效天数 |
| price | decimal | 10,2 | NO | - | 订单价格 |
| status | enum | - | YES | 'pending' | 订单状态 |
| payment_method | varchar | 50 | YES | NULL | 支付方式 |
| payment_time | datetime | - | YES | NULL | 支付时间 |
| transaction_id | varchar | 100 | YES | NULL | 第三方交易号 |
| valid_start | datetime | - | YES | NULL | 有效期开始 |
| valid_end | datetime | - | YES | NULL | 有效期结束 |
| expires_at | datetime | - | YES | NULL | 订单过期时间 |
| created_at | timestamp | - | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | YES | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

### 索引

| 索引名 | 字段 | 类型 |
|--------|------|------|
| PRIMARY | id | PRIMARY |
| order_no | order_no | UNIQUE |
| idx_user_id | user_id | KEY |
| idx_domain_id | domain_id | KEY |
| idx_package_id | package_id | KEY |
| idx_status | status | KEY |
| idx_created_at | created_at | KEY |

### 外键

| 外键名 | 字段 | 参考表 | 参考字段 | 删除规则 |
|--------|------|--------|----------|----------|
| fk_package_orders_user_id | user_id | users | id | CASCADE |
| fk_package_orders_domain_id | domain_id | domains | id | CASCADE |
| fk_package_orders_package_id | package_id | domain_packages | id | CASCADE |

---

## 附录

### 枚举值说明

#### user_verifications.status
- `pending` - 待审核
- `approved` - 已通过
- `rejected` - 已拒绝

#### user_packages.status
- `active` - 有效
- `expired` - 已过期

#### domain_records.status / parse_orders.status
- `pending` - 待支付
- `paid` - 已支付（等待审核）
- `reviewing` - 审核中
- `active` - 已通过（解析已生效）
- `rejected` - 已拒绝
- `cancelled` - 已取消
- `expired` - 已过期

#### package_orders.status
- `pending` - 待支付
- `paid` - 已支付
- `completed` - 已完成
- `cancelled` - 已取消
- `expired` - 已过期
- `refunded` - 已退款

#### domain_records.record_type / parse_orders.record_type
- `A` - A记录
- `CNAME` - CNAME记录
- `AAAA` - AAAA记录

#### email_logs.status
- `sent` - 已发送
- `failed` - 发送失败
- `pending` - 待发送

#### admin_session_logs.action_type
- `LOGIN` - 登录
- `LOGOUT` - 登出

#### security_event_logs.event_level
- `INFO` - 信息
- `WARNING` - 警告
- `ERROR` - 错误
- `CRITICAL` - 严重

#### settings.type
- `general` - 通用
- `email` - 邮件
- `geetest` - 极验
- `other` - 其他

#### users.role
- `user` - 普通用户
- `admin` - 管理员

---

## 变更记录

### V3.0 (2024-01-31)
**新增表**:
- `domain_packages` - 域名套餐表
- `user_packages` - 用户套餐表
- `domain_records` - 解析记录表
- `parse_orders` - 解析订单表
- `package_orders` - 套餐订单表

### V2.0 (2024-01-31)
**新增表**:
- `user_verifications` - 用户实名认证表

**删除表**:
- `subdomains` - 用户二级域名表
- `user_domains` - 用户购买域名表
- `user_subdomains` - 用户二级域名表(旧版)

---

**文档版本**: V3.0
**创建日期**: 2024-01-31
**数据库**: haoziwanymff
**MySQL版本**: 5.7.44
